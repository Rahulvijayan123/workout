{"test_id": "variations-P5-00-normal", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 151.92175857947674, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "squat", "sets": 3, "reps": 5}, {"lift": "bench", "sets": 3, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [], "front_squat": [], "leg_press": [], "hack_squat": [], "bench": [], "pause_bench": [], "rdl": [], "trap_bar_deadlift": []}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": null, "front_squat": null, "leg_press": null, "hack_squat": null, "bench": null, "pause_bench": null, "rdl": null, "trap_bar_deadlift": null}, "event_flags": {"missed_session": false, "injury_flags": {}, "planned_deload_week": false, "variation_overrides": {}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "squat", "prescribed_weight_lb": 205.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "squat", "acceptable_range_lb": [200.0, 210.0]}, {"lift": "bench", "prescribed_weight_lb": 125.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "bench", "acceptable_range_lb": [122.5, 127.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [200.0, 210.0]}, {"field": "session_prescription_for_today[1].lift", "expected": "bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [122.5, 127.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-01-normal", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 152.15867003434386, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "squat", "sets": 3, "reps": 5}, {"lift": "bench", "sets": 3, "reps": 5}, {"lift": "trap_bar_deadlift", "sets": 3, "reps": 4}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}], "front_squat": [], "leg_press": [], "hack_squat": [], "bench": [{"date": "2026-01-06", "weight_lb": 125.0, "reps": 5, "top_rpe": 7.8, "outcome": "success", "variation": "bench"}], "pause_bench": [], "rdl": [{"date": "2026-01-06", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": []}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 145.83, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 4, "front_squat": null, "leg_press": null, "hack_squat": null, "bench": 4, "pause_bench": null, "rdl": 4, "trap_bar_deadlift": null}, "event_flags": {"missed_session": false, "injury_flags": {}, "planned_deload_week": false, "variation_overrides": {}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "squat", "prescribed_weight_lb": 205.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "squat", "acceptable_range_lb": [200.0, 210.0]}, {"lift": "bench", "prescribed_weight_lb": 125.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "bench", "acceptable_range_lb": [122.5, 127.5]}, {"lift": "trap_bar_deadlift", "prescribed_weight_lb": 245.0, "sets": 3, "target_reps": 4, "target_rpe": 8.0, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "trap_bar_deadlift", "acceptable_range_lb": [240.0, 250.0]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [200.0, 210.0]}, {"field": "session_prescription_for_today[1].lift", "expected": "bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [122.5, 127.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "trap_bar_deadlift"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [240.0, 250.0]}]}
{"test_id": "variations-P5-02-sub_chain1", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 151.59173814719065, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "squat", "sets": 3, "reps": 6}, {"lift": "bench", "sets": 3, "reps": 6}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [], "leg_press": [], "hack_squat": [], "bench": [{"date": "2026-01-06", "weight_lb": 125.0, "reps": 5, "top_rpe": 7.8, "outcome": "success", "variation": "bench"}, {"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}], "pause_bench": [], "rdl": [{"date": "2026-01-06", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 145.83, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 4, "front_squat": null, "leg_press": null, "hack_squat": null, "bench": 4, "pause_bench": null, "rdl": 8, "trap_bar_deadlift": 4}, "event_flags": {"missed_session": false, "injury_flags": {"squat": true}, "planned_deload_week": false, "variation_overrides": {}, "substitutions": {"squat": "leg_press"}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "leg_press", "prescribed_weight_lb": 270.0, "sets": 3, "target_reps": 6, "target_rpe": 8.0, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "squat", "acceptable_range_lb": [265.0, 275.0]}, {"lift": "bench", "prescribed_weight_lb": 125.0, "sets": 3, "target_reps": 6, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "bench", "acceptable_range_lb": [122.5, 127.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "leg_press"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [265.0, 275.0]}, {"field": "session_prescription_for_today[1].lift", "expected": "bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [122.5, 127.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-03-sub_chain2", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 152.45286260365816, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "squat", "sets": 3, "reps": 8}, {"lift": "bench", "sets": 3, "reps": 6}, {"lift": "rdl", "sets": 3, "reps": 10}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [], "bench": [{"date": "2026-01-06", "weight_lb": 125.0, "reps": 5, "top_rpe": 7.8, "outcome": "success", "variation": "bench"}, {"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}], "pause_bench": [], "rdl": [{"date": "2026-01-06", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-14", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 148.75, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 8, "front_squat": null, "leg_press": 4, "hack_squat": null, "bench": 4, "pause_bench": null, "rdl": 4, "trap_bar_deadlift": 8}, "event_flags": {"missed_session": false, "injury_flags": {"squat": true}, "planned_deload_week": false, "variation_overrides": {}, "substitutions": {"squat": "hack_squat"}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "hack_squat", "prescribed_weight_lb": 230.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "squat", "acceptable_range_lb": [225.0, 235.0]}, {"lift": "bench", "prescribed_weight_lb": 125.0, "sets": 3, "target_reps": 6, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "bench", "acceptable_range_lb": [122.5, 127.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 10, "target_rpe": 7.25, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "hack_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [225.0, 235.0]}, {"field": "session_prescription_for_today[1].lift", "expected": "bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [122.5, 127.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-04-variation_primary", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 151.8562222017003, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "front_squat", "sets": 4, "reps": 5}, {"lift": "pause_bench", "sets": 4, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [], "rdl": [{"date": "2026-01-06", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-14", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-18", "weight_lb": 185.0, "reps": 10, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 0.0, "unit": "lb"}, "rollingE1RM": null, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "unknown", "successStreak": 0, "successfulSessionsCount": 0, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 242.97, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 12, "front_squat": null, "leg_press": 8, "hack_squat": 4, "bench": 4, "pause_bench": null, "rdl": 4, "trap_bar_deadlift": 12}, "event_flags": {"missed_session": false, "injury_flags": {"bench": true}, "planned_deload_week": false, "variation_overrides": {"squat": "front_squat", "bench": "pause_bench"}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "front_squat", "prescribed_weight_lb": 175.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "front_squat", "acceptable_range_lb": [172.5, 177.5]}, {"lift": "pause_bench", "prescribed_weight_lb": 115.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "variation_or_sub_start", "adjustment_kind": "none", "reference_lift": "pause_bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "front_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [172.5, 177.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "pause_bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-05-variation_primary", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 151.66681405568102, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "front_squat", "sets": 4, "reps": 5}, {"lift": "pause_bench", "sets": 4, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-01-22", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-01-22", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-01-14", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-18", "weight_lb": 185.0, "reps": 10, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-22", "weight_lb": 185.0, "reps": 8, "top_rpe": 7.9, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 238.03, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 16, "front_squat": 4, "leg_press": 12, "hack_squat": 8, "bench": 8, "pause_bench": 4, "rdl": 4, "trap_bar_deadlift": 16}, "event_flags": {"missed_session": false, "injury_flags": {"bench": true}, "planned_deload_week": false, "variation_overrides": {"squat": "front_squat", "bench": "pause_bench"}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "front_squat", "prescribed_weight_lb": 175.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "front_squat", "acceptable_range_lb": [172.5, 177.5]}, {"lift": "pause_bench", "prescribed_weight_lb": 115.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "pause_bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "front_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [172.5, 177.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "pause_bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-06-variation_primary", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 151.5471243882002, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "front_squat", "sets": 4, "reps": 5}, {"lift": "pause_bench", "sets": 4, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-01-22", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "front_squat"}, {"date": "2026-01-26", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-01-22", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-01-26", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-01-18", "weight_lb": 185.0, "reps": 10, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-22", "weight_lb": 185.0, "reps": 8, "top_rpe": 7.9, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-26", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 20, "front_squat": 4, "leg_press": 16, "hack_squat": 12, "bench": 12, "pause_bench": 4, "rdl": 4, "trap_bar_deadlift": 20}, "event_flags": {"missed_session": false, "injury_flags": {"bench": true}, "planned_deload_week": false, "variation_overrides": {"squat": "front_squat", "bench": "pause_bench"}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "front_squat", "prescribed_weight_lb": 175.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "front_squat", "acceptable_range_lb": [172.5, 177.5]}, {"lift": "pause_bench", "prescribed_weight_lb": 115.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "pause_bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "front_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [172.5, 177.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "pause_bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-07-variation_primary", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 151.6046987211574, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "front_squat", "sets": 4, "reps": 5}, {"lift": "pause_bench", "sets": 4, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-01-22", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "front_squat"}, {"date": "2026-01-26", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "front_squat"}, {"date": "2026-01-30", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.6, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-01-22", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-01-26", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-01-30", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.4, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-01-22", "weight_lb": 185.0, "reps": 8, "top_rpe": 7.9, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-26", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-30", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 24, "front_squat": 4, "leg_press": 20, "hack_squat": 16, "bench": 16, "pause_bench": 4, "rdl": 4, "trap_bar_deadlift": 24}, "event_flags": {"missed_session": false, "injury_flags": {"bench": true}, "planned_deload_week": false, "variation_overrides": {"squat": "front_squat", "bench": "pause_bench"}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "front_squat", "prescribed_weight_lb": 175.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "front_squat", "acceptable_range_lb": [172.5, 177.5]}, {"lift": "pause_bench", "prescribed_weight_lb": 115.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "pause_bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "front_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [172.5, 177.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "pause_bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-08-variation_primary", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 152.37944699514077, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "front_squat", "sets": 4, "reps": 5}, {"lift": "pause_bench", "sets": 4, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-01-26", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "front_squat"}, {"date": "2026-01-30", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.6, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-03", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-01-26", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.7, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-01-30", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.4, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-03", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-01-26", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-01-30", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-03", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 28, "front_squat": 4, "leg_press": 24, "hack_squat": 20, "bench": 20, "pause_bench": 4, "rdl": 4, "trap_bar_deadlift": 28}, "event_flags": {"missed_session": false, "injury_flags": {"bench": true}, "planned_deload_week": false, "variation_overrides": {"squat": "front_squat", "bench": "pause_bench"}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "front_squat", "prescribed_weight_lb": 175.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "front_squat", "acceptable_range_lb": [172.5, 177.5]}, {"lift": "pause_bench", "prescribed_weight_lb": 115.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "pause_bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "front_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [172.5, 177.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "pause_bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-09-variation_primary", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 152.768861626267, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "front_squat", "sets": 4, "reps": 5}, {"lift": "pause_bench", "sets": 4, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-01-30", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.6, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-03", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-07", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-01-30", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.4, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-03", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-07", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-01-30", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-03", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-07", "weight_lb": 185.0, "reps": 8, "top_rpe": 7.9, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 32, "front_squat": 4, "leg_press": 28, "hack_squat": 24, "bench": 24, "pause_bench": 4, "rdl": 4, "trap_bar_deadlift": 32}, "event_flags": {"missed_session": false, "injury_flags": {"bench": true}, "planned_deload_week": false, "variation_overrides": {"squat": "front_squat", "bench": "pause_bench"}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "front_squat", "prescribed_weight_lb": 175.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "front_squat", "acceptable_range_lb": [172.5, 177.5]}, {"lift": "pause_bench", "prescribed_weight_lb": 115.0, "sets": 4, "target_reps": 5, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "pause_bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "front_squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [172.5, 177.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "pause_bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-10-return", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 152.21660012226275, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "squat", "sets": 3, "reps": 5}, {"lift": "bench", "sets": 3, "reps": 5}, {"lift": "rdl", "sets": 3, "reps": 8}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-02-03", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-07", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-11", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-10", "weight_lb": 125.0, "reps": 5, "top_rpe": 8.0, "outcome": "success", "variation": "bench"}, {"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-02-03", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-07", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-11", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.6, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-02-03", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-07", "weight_lb": 185.0, "reps": 8, "top_rpe": 7.9, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-11", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 205.0, "unit": "lb"}, "rollingE1RM": 239.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 2, "successfulSessionsCount": 2, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 125.0, "unit": "lb"}, "rollingE1RM": 150.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 36, "front_squat": 4, "leg_press": 32, "hack_squat": 28, "bench": 28, "pause_bench": 4, "rdl": 4, "trap_bar_deadlift": 36}, "event_flags": {"missed_session": false, "injury_flags": {}, "planned_deload_week": false, "variation_overrides": {}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "squat", "prescribed_weight_lb": 195.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "decrease_small", "reason_code": "return_to_standard_after_variation_ramp_5pct", "adjustment_kind": "breakReset", "reference_lift": "squat", "acceptable_range_lb": [190.0, 200.0]}, {"lift": "bench", "prescribed_weight_lb": 120.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "decrease_small", "reason_code": "return_to_standard_after_variation_ramp_5pct", "adjustment_kind": "breakReset", "reference_lift": "bench", "acceptable_range_lb": [117.5, 122.5]}, {"lift": "rdl", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 8, "target_rpe": 7.75, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "rdl", "acceptable_range_lb": [182.5, 187.5]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [190.0, 200.0]}, {"field": "session_prescription_for_today[1].lift", "expected": "bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [117.5, 122.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "rdl"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [182.5, 187.5]}]}
{"test_id": "variations-P5-11-return", "test_category": "substitution", "description": "P5: substitutions/variations. Tests separate state per variation, substitution chain, and conservative ramp on return.", "input": {"user_profile": {"sex": "female", "age": 30, "height_cm": 168, "body_weight_lb": 152.0, "experience_level": "intermediate", "program": "upper_lower_4x", "goal": "strength_hypertrophy"}, "equipment": ["barbell", "machine"], "equipment_config": {"units": "lb", "bar_weight_lb": 45, "load_step_lb": 2.5}, "today_metrics": {"body_weight_lb": 152.5174918583129, "sleep_hours": 7.2, "hrv_ms": 55, "resting_hr_bpm": 61, "soreness_1_to_10": 4, "stress_1_to_10": 4, "steps": 8500, "calories_est": 2400}, "today_session_template": [{"lift": "squat", "sets": 3, "reps": 5}, {"lift": "bench", "sets": 3, "reps": 5}, {"lift": "trap_bar_deadlift", "sets": 3, "reps": 4}], "recent_lift_history": {"squat": [{"date": "2026-01-06", "weight_lb": 205.0, "reps": 5, "top_rpe": 8.2, "outcome": "success", "variation": "squat"}, {"date": "2026-01-10", "weight_lb": 205.0, "reps": 5, "top_rpe": 7.9, "outcome": "success", "variation": "squat"}, {"date": "2026-02-15", "weight_lb": 195.0, "reps": 5, "top_rpe": 8.1, "outcome": "success", "variation": "squat"}], "front_squat": [{"date": "2026-02-03", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-07", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "front_squat"}, {"date": "2026-02-11", "weight_lb": 175.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "front_squat"}], "leg_press": [{"date": "2026-01-14", "weight_lb": 270.0, "reps": 6, "top_rpe": 8.0, "outcome": "success", "variation": "leg_press"}], "hack_squat": [{"date": "2026-01-18", "weight_lb": 230.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "hack_squat"}], "bench": [{"date": "2026-01-14", "weight_lb": 125.0, "reps": 6, "top_rpe": 8.2, "outcome": "success", "variation": "bench"}, {"date": "2026-01-18", "weight_lb": 125.0, "reps": 6, "top_rpe": 7.9, "outcome": "success", "variation": "bench"}, {"date": "2026-02-15", "weight_lb": 120.0, "reps": 5, "top_rpe": 7.8, "outcome": "success", "variation": "bench"}], "pause_bench": [{"date": "2026-02-03", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.5, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-07", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.8, "outcome": "success", "variation": "pause_bench"}, {"date": "2026-02-11", "weight_lb": 115.0, "reps": 5, "top_rpe": 8.6, "outcome": "success", "variation": "pause_bench"}], "rdl": [{"date": "2026-02-07", "weight_lb": 185.0, "reps": 8, "top_rpe": 7.9, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-11", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.1, "outcome": "success", "variation": "rdl"}, {"date": "2026-02-15", "weight_lb": 185.0, "reps": 8, "top_rpe": 8.2, "outcome": "success", "variation": "rdl"}], "trap_bar_deadlift": [{"date": "2026-01-10", "weight_lb": 245.0, "reps": 4, "top_rpe": 8.1, "outcome": "success", "variation": "trap_bar_deadlift"}]}, "lift_state": {"squat": {"exerciseId": "squat", "lastWorkingWeight": {"value": 195.0, "unit": "lb"}, "rollingE1RM": 231.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "front_squat": {"exerciseId": "front_squat", "lastWorkingWeight": {"value": 175.0, "unit": "lb"}, "rollingE1RM": 204.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "leg_press": {"exerciseId": "leg_press", "lastWorkingWeight": {"value": 270.0, "unit": "lb"}, "rollingE1RM": 324.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "hack_squat": {"exerciseId": "hack_squat", "lastWorkingWeight": {"value": 230.0, "unit": "lb"}, "rollingE1RM": 291.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}, "bench": {"exerciseId": "bench", "lastWorkingWeight": {"value": 120.0, "unit": "lb"}, "rollingE1RM": 143.0, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "pause_bench": {"exerciseId": "pause_bench", "lastWorkingWeight": {"value": 115.0, "unit": "lb"}, "rollingE1RM": 134.17, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "rdl": {"exerciseId": "rdl", "lastWorkingWeight": {"value": 185.0, "unit": "lb"}, "rollingE1RM": 234.33, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "improving", "successStreak": 3, "successfulSessionsCount": 3, "recentReadinessScores": []}, "trap_bar_deadlift": {"exerciseId": "trap_bar_deadlift", "lastWorkingWeight": {"value": 245.0, "unit": "lb"}, "rollingE1RM": 277.67, "failureCount": 0, "highRpeStreak": 0, "lastDeloadDate": null, "trend": "stable", "successStreak": 1, "successfulSessionsCount": 1, "recentReadinessScores": []}}, "days_since_last_session": 3, "days_since_lift_exposure": {"squat": 4, "front_squat": 8, "leg_press": 36, "hack_squat": 32, "bench": 4, "pause_bench": 8, "rdl": 4, "trap_bar_deadlift": 40}, "event_flags": {"missed_session": false, "injury_flags": {}, "planned_deload_week": false, "variation_overrides": {}, "substitutions": {}}, "config_overrides": {"progression_policy": "variation_aware", "deload_config": {"intensityReduction": 0.08, "volumeReduction": 1, "failuresBeforeDeload": 2}}}, "expected_output": {"session_prescription_for_today": [{"lift": "squat", "prescribed_weight_lb": 185.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "decrease_small", "reason_code": "return_to_standard_after_variation_ramp_5pct", "adjustment_kind": "breakReset", "reference_lift": "squat", "acceptable_range_lb": [182.5, 187.5]}, {"lift": "bench", "prescribed_weight_lb": 115.0, "sets": 3, "target_reps": 5, "target_rpe": 8.0, "decision": "decrease_small", "reason_code": "return_to_standard_after_variation_ramp_5pct", "adjustment_kind": "breakReset", "reference_lift": "bench", "acceptable_range_lb": [112.5, 117.5]}, {"lift": "trap_bar_deadlift", "prescribed_weight_lb": 245.0, "sets": 3, "target_reps": 4, "target_rpe": 8.0, "decision": "hold", "reason_code": "hold_under_uncertainty_variation", "adjustment_kind": "none", "reference_lift": "trap_bar_deadlift", "acceptable_range_lb": [240.0, 250.0]}]}, "assertions": [{"field": "session_prescription_for_today[0].lift", "expected": "squat"}, {"field": "session_prescription_for_today[0].prescribed_weight_lb", "expected_range": [182.5, 187.5]}, {"field": "session_prescription_for_today[1].lift", "expected": "bench"}, {"field": "session_prescription_for_today[1].prescribed_weight_lb", "expected_range": [112.5, 117.5]}, {"field": "session_prescription_for_today[2].lift", "expected": "trap_bar_deadlift"}, {"field": "session_prescription_for_today[2].prescribed_weight_lb", "expected_range": [240.0, 250.0]}]}
